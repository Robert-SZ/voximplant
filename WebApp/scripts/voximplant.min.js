(function(){var e=this,n=function(){};if(function(e,t){var n="VI_WEBRTC_STATE_IDLE",i="VI_WEBRTC_STATE_WS_CONNECTING",o="VI_WEBRTC_STATE_WS_CONNECTED",s="VI_WEBRTC_STATE_WS_CONNECTED",a=e.VI_CALL_STATE_ALERTING="ALERTING",r=e.VI_CALL_STATE_PROGRESSING="PROGRESSING",l=e.VI_CALL_STATE_CONNECTED="CONNECTED",c=e.VI_CALL_STATE_ENDED="ENDED",h=6e3;e.ZingayaAPI=function(e,t){function d(){G&&(clearTimeout(G),G=null,j=setTimeout(me,E))}var u,f,p,C,m,g,v,y,S,T,R,I,E=3e4,w=[],O=[],A=!1!==t,P=function(){return w.length?w.pop():document.createElement("audio")},M=function(e){f(e,null),w.push(e)},b=function(){return O.length?O.pop():document.createElement("video")},N=function(e){f(e,null),O.push(e)},_=function(e){if(e){if(e.audioTracks)return e.audioTracks;if(e.getAudioTracks)return e.getAudioTracks()}return null},U=function(e){if(e){if(e.videoTracks)return e.videoTracks;if(e.getVideoTracks)return e.getVideoTracks()}return null},L=function(e,t){if(e)for(var n in e)e[n].enabled=t},F=e===!0?!0:!1,D="wss",V=null,x=n,z=!1,k=!1,W=!0,H=null,j=null,G=null,X=1,q=function(){m="undefined"!=typeof webkitRTCPeerConnection,g="undefined"!=typeof mozRTCPeerConnection,v="undefined"!=typeof MediaStreamTrack&&"undefined"!=typeof MediaStreamTrack.getSources,y=null,S=null,T=null,g&&(C=mozRTCIceCandidate,p=mozRTCPeerConnection,u=navigator.mozGetUserMedia.bind(navigator),f=function(e,t){t?(e.mozSrcObject=t,e.load(),e.play()):(e.mozSrcObject=null,e.load())}),m&&(p=webkitRTCPeerConnection,C=RTCIceCandidate,u=navigator.webkitGetUserMedia.bind(navigator),f=function(e,t){t?(e.src=URL.createObjectURL(t),e.load(),e.play()):e.pause()})},B=null,J={},K={},$=0,Z=function(e){"function"==typeof this.writeLog&&this.writeLog(e)}.bind(this),Q=function(e){"function"==typeof this.writeTrace&&this.writeTrace(e)}.bind(this),Y=function(e){return x!=s?(Z(e+" called while in state "+x),!1):!0},ee={year:"numeric",month:"numeric",day:"numeric"};this.writeLog=function(e){console.log("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",ee)+" "+e)},this.writeTrace=function(e){console.log("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",ee)+" "+e)},this.onConnectionEstablished=null,this.onConnectionFailed=null,this.onConnectionClosed=null,this.onLoginSuccessful=null,this.onLoginFailed=null,this.onIncomingCall=null,this.onCallRinging=null,this.onCallMediaStarted=null,this.onCallConnected=null,this.onCallEnded=null,this.onCallFailed=null,this.onSIPInfoReceived=null,this.onInstantMessageReceived=null,this.onTransferComplete=null,this.onTransferFailed=null,this.onNetStatsReceived=null,this.onHandleRoster=null,this.onHandleRosterPresence=null,this.onHandleMessage=null,this.onHandleSelfPresence=null,this.onHandleChatState=null,this.onHandleMessageEvent=null,this.onHandleSubscription=null,this.onHandleRosterItem=null,this.onCallRemoteFunctionError=null,this.onIMError=null,this.onIMRosterError=null,this.onMUCError=null,this.onMUCRoomCreation=null,this.onMUCSubject=null,this.onMUCInfo=null,this.onMUCMessage=null,this.onMUCInvitation=null,this.onMUCInviteDecline=null,this.onMUCParticipantPresence=null,this.onMUCRooms=null,this.onMUCParticipants=null,this.onHistory=null,this.onVoicemail=null,this.onCheckComplete=null,this.onRemoteScreenCaptureStarted=null,this.onCallICETimeout=null;var te=function(e,t){"function"==typeof this.onRemoteScreenCaptureStarted&&this.onRemoteScreenCaptureStarted(e,t)}.bind(this),ne=function(e){"function"==typeof this.onCallICETimeout&&this.onCallICETimeout(e)}.bind(this),ie=function(e){var t={};for(var n in e)("X-"==n.substring(0,2)||"VI-CallData"==n)&&(t[n]=e[n]);return t},oe=function(e){for(var t in e)if("X-DirectCall"==t)return"true"==e[t]?!0:!1;return!1},se=function(){$=0;for(var e in J)$++},ae=function(e){J[e.id()]=e,se()},re=function(e){delete J[e],se()}.bind(this);q();var le=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;e>i;i++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},ce=function(){};this.muteMicrophone=function(e){z=e,B&&L(_(B),!e)},this.sendVideo=function(e){W=e,B&&L(U(B),e)},this.mutePlayback=function(e){k=e;for(var t in K)K[t].updateSpeakerMuteState()},this.setPlaybackVolume=function(e){X=e;for(var t in K)K[t].setPlaybackVolume(e)},this.getCalls=function(){var e=[];for(var t in J)e.push(t);return e},this.setLocalVideoSink=function(e){R=e,B&&f(e,B)},this.setRemoteSinksContainerId=function(e){I=e},this.stopLocalStream=function(){B&&(B.stop(),B=null)}.bind(this),this.destroy=function(){this.disconnect(),this.stopLocalStream()}.bind(this),this.disconnect=function(){V&&(Ce(),V.onclose=null,V.close(),ue())},this.useAudioSource=function(e,t,n,i){v&&(y=e,this.requestMedia(i,t,n,F))}.bind(this),this.useVideoSource=function(e,t,n){v&&(S=e,this.requestMedia(!0,t,n,!0))}.bind(this),this.setConstraints=function(e,t,n,i){T=e,i===!0&&this.requestMedia(F,t,n,F)}.bind(this),this.requestMedia=function(e,t,n,i){var o;null===y&&null===S?o={audio:!0,video:e===!0?!0:!1}:null!==y&&null!==S?o={audio:{optional:[{sourceId:y}]},video:{optional:[{sourceId:S}]}}:null!==y?o={audio:{optional:[{sourceId:y}]},video:e===!0?!0:!1}:null!==S&&(o={audio:!0,video:{optional:[{sourceId:S}]}}),null!==T&&(o.video={},"undefined"!=typeof T.mandatory&&(o.video.mandatory=T.mandatory),"undefined"!=typeof T.optional?(o.video.optional=T.optional,null!==S&&o.video.optional.push({sourceId:S})):null!==S&&(o.video.optional=[{sourceId:S}])),B&&i&&(B.stop(),B=null),"undefined"!=typeof o.video.mandatory&&"undefined"!=typeof o.video.mandatory.chromeMediaSourceId&&(o.audio=!1),u(o,function(e){var n;if(B){B.stop();for(n in K)K[n].setLocalStream(null)}Z("Media access granted"),B=e,L(_(B),!z),R&&f(R,e);for(n in K)K[n].setLocalStream(B);"function"==typeof t&&t();for(n in ge)ve(n,ge[n]);ge={}}.bind(this),function(e){Z("Media access rejected: "+e.name),"function"==typeof n&&n(e.name)})}.bind(this),this.shareScreen=function(){"undefined"!=typeof getScreenId?getScreenId(function(e,t,n){u(n,function(e){H=e;for(var t in K)K[t].isDirect()&&K[t].addScreenSharing(H)},function(e){Z(e)})}):Z("No screensharing extension is available")},this.getRemoteParty=function(e){return J[e]?J[e].getRemoteParty():null},this.getCallState=function(e){return J[e]?J[e].getState():null},this.setCallActive=function(e,t){return J[e]?(t?this.unholdCall(e):this.holdCall(e),J[e].setStreamsActive(t)):void 0},this.isCallActive=function(e){return J[e]?J[e].streamsAreActive():!1},this.connectTo=function(e,t,o,s){x==n?(V=new WebSocket(D+"://"+e+"/"+(s||"platform")+"?version=2&client="+(g?"firefox":"chrome")+"&referrer="+encodeURIComponent(t)+"&extra="+encodeURIComponent(o)+"&video="+(F===!0?"true":"false")+"&q="+le(12)),x=i,V.onopen=pe,V.onclose=Ce,V.onerror=fe,V.onmessage=Te):Z("Error: called connectTo while in state "+x)}.bind(this),this.startPreFlightCheck=function(e,t){Y("__startPreFlightCheck")&&we("__startPreFlightCheck",[!!e,!!t])},this.login=function(e,t,n){Y("login")&&we("login",[e,t,n?n:null])},this.loginStage2=function(e,t,n){Y("loginStage2")&&we("loginStage2",[e,t,n?n:null])},this.loginGenerateOneTimeKey=function(e){Y("loginGenerateOneTimeKey")&&we("loginGenerateOneTimeKey",[e])},this.loginUsingOneTimeKey=function(e,t,n){Y("loginUsingOneTimeKey")&&we("loginUsingOneTimeKey",[e,t,n?n:null])},this.setOperatorACDStatus=function(e){Y("setOperatorACDStatus")&&we("setOperatorACDStatus",[e])},this.callTo=function(e,t,n,i){var o=le(36);n=ie("undefined"==typeof n?{}:n);var s=new Ie(o,r,e,"");if(s.setHeaders(n),ae(s),oe(n)){var a=ye(o,!0);a.outgoingCall()}else we("createCall",[-1,e,t,o,null,null,n,i]);return o},this.transferCall=function(e,t){var n=[e,t];for(var i in n){var o=J[n[i]];if(!o)return void Z("ERROR: trying to transfer unknown call "+o.id());if(o.getState()!=l)return void Z("ERROR: trying to transfer call "+o.id()+" in state "+o.getState())}we("transferCall",[e,t])},this.hangupCall=function(e,t){var n=J[e];n?n.getState()==a?we("rejectCall",[e,!0,ie(t)]):we("disconnectCall",[e,ie(t)]):Z("ERROR: trying to hangup unknown call "+e)},this.rejectCall=function(e,t,n){var i=J[e];i?i.getState()==a?we("rejectCall",[e,!0,ie(n)]):Z("ERROR: trying to reject call "+e+" in state "+i.getState()):Z("ERROR: trying to reject unknown call "+e)},this.answerCall=function(e,t){var n=J[e];if(n)if(n.getState()==a)if(oe(n.getHeaders())){var i=n.getPeerConnection();i.createAnswer()}else we("acceptCall",[e,ie(t)]);else Z("ERROR: trying to answer call "+e+" in state "+n.getState());else Z("ERROR: trying to answer unknown call "+e)},this.sendDigit=function(e,t){var n=J[e];n?n.getState()==l?we("sendDTMF",[e,t]):Z("ERROR: trying to send digit to call "+e+" in state "+n.getState()):Z("ERROR: trying to send digit to unknown call "+e)},this.holdCall=function(e){var t=J[e];t?t.getState()==l?we("hold",[e]):Z("ERROR: trying to hold call "+e+" in state "+t.getState()):Z("ERROR: trying to hold unknown call "+e)},this.unholdCall=function(e){var t=J[e];t?t.getState()==l?we("unhold",[e]):Z("ERROR: trying to unhold call "+e+" in state "+t.getState()):Z("ERROR: trying to unhold unknown call "+e)},this.voicemailPromptFinished=function(e){var t=J[e];t?we("promptFinished",[e]):Z("ERROR: trying to record voicemail for unknown call "+e)},this.sendSIPInfo=function(e,t,n,i,o){var s=J[e];s?s.getState()==l||s.getState()==a||s.getState()==r?we("sendSIPInfo",[e,t,n,i,ie(o)]):Z("ERROR: trying to send SIP Info to call "+e+" in state "+s.getState()):Z("ERROR: trying to send SIP Info to unknown call "+e)};var he=this.sendSIPInfo.bind(this);this.sendInstantMessage=function(e,t){this.sendSIPInfo(e,"application","zingaya-im",t,{})},this.sendTextMessage=function(e,t,n){Y("sendMessage")&&we("sendMessage",[e,t,n])},this.sendStatus=function(e,t){Y("sendStatus")&&we("sendStatus",[e,t])},this.sendChatState=function(e,t){Y("sendChatState")&&we("sendChatState",[e,t])},this.raiseMessageEvent=function(e,t,n){Y("raiseMessageEvent")&&we("raiseMessageEvent",[e,t,n])},this.addRoster=function(e,t,n){Y("addRoster")&&we("addRoster",[e,t,n])},this.addRosterItemGroup=function(e,t){Y("addRosterItemGroup")&&we("addRosterItemGroup",[e,t])},this.delRosterItemGroup=function(e,t){Y("delRosterItemGroup")&&we("delRosterItemGroup",[e,t])},this.moveRosterItemGroup=function(e,t,n){Y("moveRosterItemGroup")&&we("moveRosterItemGroup",[e,t,n])},this.renameRosterItem=function(e,t){Y("renameRosterItem")&&we("renameRosterItem",[e,t])},this.removeRoster=function(e){Y("removeRoster")&&we("removeRoster",[e])},this.joinMUC=function(e,t){Y("joinMUC")&&we("joinMUC",[e,t])},this.leaveMUC=function(e,t){Y("leaveMUC")&&we("leaveMUC",[e,t])},this.sendMUCMessage=function(e,t,n){Y("sendMUCMessage")&&we("sendMUCMessage",[e,t,n])},this.inviteMUC=function(e,t,n,i){Y("inviteMUC")&&we("inviteMUC",[e,t,n,i])},this.declineMUCinvitation=function(e,t,n){Y("declineMUCinvitation")&&we("declineMUCinvitation",[e,t,n])},this.ucReconnect=function(){Y("ucReconnect")&&we("ucReconnect",[])},this.requestHistory=function(e,t,n,i){"undefined"==typeof n&&(n=!1),"undefined"==typeof i&&(i=100),"undefined"==typeof t&&(t=""),Y("requestHistory")&&we("requestHistory",[e,t,n,i])},this.requestMUCHistory=function(e,t,n,i){"undefined"==typeof n&&(n=!1),"undefined"==typeof i&&(i=100),"undefined"==typeof t&&(t=""),Y("requestMUCHistory")&&we("requestMUCHistory",[e,t,n,i])},this.setSubject=function(e,t){Y("setSubject")&&we("setSubject",[e,t])},this.getVideoElementId=function(e){var t=J[e];return t?t.getVideoElementId():void Z("ERROR: No such call "+e)},this.getStats=function(e,t){var n=K[e];n&&n.getStats(t)};var de,ue=function(){for(var e in K)K[e].close();K={},J={},$=0,j&&clearTimeout(j),G&&clearTimeout(G)},fe=function(e){V.oncloe=null,Z("WS error: "+e),x=n,ue(),"function"==typeof this.onConnectionFailed&&this.onConnectionFailed(e)}.bind(this),pe=function(){x=o,Z("WS connected")}.bind(this),Ce=function(){Z("WS closed");var e=x==s,t=e?this.onConnectionClosed:this.onConnectionFailed;x=n,ue(),"function"==typeof t&&t("Connection closed")}.bind(this),me=function(){j=null,we("__ping",[]),G=setTimeout(function(){if($>0)return void d();G=null,Z("WS closed");var e=x==s,t=e?this.onConnectionClosed:this.onConnectionFailed;x=n,ue(),"function"==typeof t&&t("Connection closed")}.bind(this),E)}.bind(this),ge={},ve=function(e,t){var n=ye(e,!1);n.start(t)},ye=function(e,t){console.log("createPeerConnection2 invoked"),K[e]&&K[e].close();var n=new Ee(e,t);J[e]&&n.setStreamsActive(J[e].streamsAreActive()),K[e]=n,n.setLocalStream(B),H&&n.setScreenSharingStream(H);var i=J[e];return i&&(J[e].setPeerConnection(n),n.setCall(i)),K[e]},Se=null;de={__createPC:function(e,t){!A||B||"__default"==e?ve(e,t):ge[e]=t},__destroyPC:function(e){K[e]&&(K[e].close(),delete K[e]),delete ge[e]},__onPCStats:function(e,t){K[e]&&"function"==typeof this.onNetStatsReceived&&this.onNetStatsReceived(t)},__pong:function(){d()},__connectionSuccessful:function(){x==o&&(x=s,"function"==typeof this.onConnectionEstablished&&this.onConnectionEstablished(),j=setTimeout(me,E))},loginSuccessful:function(e,t){t&&(Se=t.iceConfig),"function"==typeof this.onLoginSuccessful&&this.onLoginSuccessful(e,t)},loginFailed:function(e,t){"function"==typeof this.onLoginFailed&&this.onLoginFailed({errorCode:e,oneTimeKey:t})},handleConnectionConnected:function(e,t,n){var i=J[e];if(i)if(i.canStartSendingCandidates(),i.getState()==r||i.getState()==a){if(i.setState(l),"undefined"==typeof n);else{var o=i.getPeerConnection();o.onConnectionConnected(n)}"function"==typeof this.onCallConnected&&this.onCallConnected(e,t)}else Z("WARNING: received handleConnectionConnected for call: "+e+" in invalid state: "+i.getState());else Z("WARNING: received handleConnectionConnected for unknown call: "+e)},stopRinging:function(e){var t=J[e];t?(t.canStartSendingCandidates(),"function"==typeof this.onCallMediaStarted&&this.onCallMediaStarted(e)):Z("WARNING: received stopRinging for unknown call: "+e)},handleConnectionDisconnected:function(e,t){var n=J[e];n?(n.setState(c),"function"==typeof this.onCallEnded&&this.onCallEnded(e,t),re(e)):Z("WARNING: received handleConnectionDisconnected for unknown call: "+e)},handleConnectionFailed:function(e,t,n,i){var o=J[e];o?o.getState()==r?(o.setState(c),"function"==typeof this.onCallFailed&&this.onCallFailed(e,t,n,i),re(e)):Z("WARNING: received handleConnectionFailed for call: "+e+" in invalid state: "+o.getState()):Z("WARNING: received handleConnectionFailed for unknown call: "+e)},handleRingOut:function(e){var t=J[e];t?(t.canStartSendingCandidates(),t.getState()==r?"function"==typeof this.onCallRinging&&this.onCallRinging(e):Z("WARNING: received handleRingOut for call: "+e+" in invalid state: "+t.getState())):Z("WARNING: received handleRingOut for unknown call: "+e)},handleIncomingConnection:function(e,t,n,i,o){var s=new Ie(e,a,t,n);if(s.setHeaders(i),ae(s),oe(i)){var r=ye(e,!0);r.onIncomingCall(o)}else K[e]&&s.setPeerConnection(K[e]);"function"==typeof this.onIncomingCall?this.onIncomingCall(e,t,n,i):(this.rejectCall(e,486),Z("WARNING: Received incoming call while no handler was specified"))},handleSIPInfo:function(e,t,n,i,o){var s=J[e];if(s)if(s.getState()==l||s.getState()==r||s.getState()==a)if("application"==t&&"zingaya-im"==n)"function"==typeof this.onInstantMessageReceived&&this.onInstantMessageReceived(e,i);else if("voximplant"==t&&"sdpfrag"==n){cands=JSON.parse(i);var c=s.getPeerConnection();for(var h in cands)c.addRemoteCandidate(cands[h][0],cands[h][1])}else if("vi"==t&&"sdpoffer"==n){var c=s.getPeerConnection();c.setRemoteSDP(!0,i,o["X-ScreenStreamId"])}else if("vi"==t&&"sdpanswer"==n){var c=s.getPeerConnection();c.setRemoteSDP(!1,i,o["X-ScreenStreamId"])}else"function"==typeof this.onSIPInfoReceived&&this.onSIPInfoReceived(e,t+"/"+n,i,o);else Z("WARNING: received handleSIPInfo for call: "+e+" in invalid state: "+s.getState());else Z("WARNING: received handleSIPInfo for unknown call: "+e)},handleSipEvent:function(){},handleTransferStarted:function(){},handleTransferComplete:function(e){var t=J[e];t?this.onTransferComplete&&this.onTransferComplete(e):Z("WARNING: received handleTransferComplete for unknown call: "+e)},handleTransferFailed:function(e){var t=J[e];t?this.onTransferFailed&&this.onTransferFailed(e):Z("WARNING: received handleTransferFailed for unknown call: "+e)},handleRoster:function(e,t){Q("handleRoster"),"function"==typeof this.onHandleRoster&&this.onHandleRoster(e,t)},handleRosterItem:function(e,t,n,i){Q("handleRosterItem from "+e+": "+n),"function"==typeof this.onHandleRosterItem&&this.onHandleRosterItem(e,t,n,i)},handleRosterPresence:function(e,t,n,i){Q("handleRosterPresence"),"function"==typeof this.onHandleRosterPresence&&this.onHandleRosterPresence(e,t,n,i)},handleMessage:function(e,t,n,i){Q("handleMessage from "+e+": "+n),"function"==typeof this.onHandleMessage&&this.onHandleMessage(e,t,n,i)},handleSelfPresence:function(e,t,n,i){Q("handleSelfPresence from "+e+": "+n),"function"==typeof this.onHandleSelfPresence&&this.onHandleSelfPresence(e,t,n,i)},handleChatState:function(e,t,n){Q("handleChatState from "+e+": "+n),"function"==typeof this.onHandleChatState&&this.onHandleChatState(e,t,n)},handleMessageEvent:function(e,t,n,i){Q("handleMessageEvent from "+e+": "+n),"function"==typeof this.onHandleMessageEvent&&this.onHandleMessageEvent(e,t,n,i)},handleSubscription:function(e,t,n,i){Q("handleSubscription from "+e+": "+n),"function"==typeof this.onHandleSubscription&&this.onHandleSubscription(e,t,n,i)},onCallRemoteFunctionError:function(e,t,n,i){Q("onCallRemoteFunctionError method "+e+" params "+t+" code "+n+" description "+i),"function"==typeof this.onCallRemoteFunctionError&&this.onCallRemoteFunctionError(e,t,n,i)},handleError:function(e,t,n){Q("handleError type "+e+" code "+t+" description "+n),"function"==typeof this.onIMError&&this.onIMError(e,t,n)},handleUCConnected:function(){Q("handleUCConnected"),"function"==typeof this.onUCConnected&&this.onUCConnected()},handleUCDisconnected:function(){Q("handleUCDisconnected"),"function"==typeof this.onUCDisconnected&&this.onUCDisconnected()},handleRosterError:function(e){Q("handleRosterError code "+e),"function"==typeof this.onIMRosterError&&this.onIMRosterError(e)},handleMUCError:function(e,t,n,i){Q("handleMUCError room "+e+" operation "+t+" code "+n+" text "+i),"function"==typeof this.onMUCError&&this.onMUCError(e,t,n,i)},handleMUCRoomCreation:function(e){Q("handleMUCRoomCreation room "+e),"function"==typeof this.onMUCRoomCreation&&this.onMUCRoomCreation(e)},handleMUCSubject:function(e,t,n){Q("handleMUCSubject room "+e+" id "+t+" subject "+n),"function"==typeof this.onMUCSubject&&this.onMUCSubject(e,t,n)},handleMUCInfo:function(e,t,n,i){Q("handleMUCInfo room "+e+" features "+t+" name "+n+" info "+i),"function"==typeof this.onMUCInfo&&this.onMUCInfo(e,t,n,i)},handleMUCMessage:function(e,t,n,i,o,s){Q("handleMUCMessage room "+e+" message_id "+n+" private "+t+" timestamp "+i+" from "+o+" msg "+s),"function"==typeof this.onMUCMessage&&this.onMUCMessage(e,n,t,i,o,s)},handleMUCInvitation:function(e,t,n,i,o,s,a){Q("handleMUCInvitation room "+e+" from "+t+" reason "+n+" body "+i+" password "+o+" cont "+s+" thread "+a),"function"==typeof this.onMUCInvitation&&this.onMUCInvitation(e,t,n,i,o,s,a)},handleMUCInviteDecline:function(e,t,n){Q("handleMUCInviteDecline room "+e+" invitee "+t+" reason "+n),"function"==typeof this.onMUCInviteDecline&&this.onMUCInviteDecline(e,t,n)},handleMUCParticipantPresence:function(e,t,n,i){Q("handleMUCParticipantPresence room "+e+" participant "+t+" presence "+n+" msg "+i),"function"==typeof this.onMUCParticipantPresence&&this.onMUCParticipantPresence(e,t,n,i)},handleMUCRooms:function(e){Q("handleMUCRooms rooms "+e),"function"==typeof this.onMUCRooms&&this.onMUCRooms(e)},handleMUCParticipants:function(e,t,n){Q("handleMUCParticipants room "+e+" list "+t+" type "+n),"function"==typeof this.onMUCParticipants&&this.onMUCParticipants(e,t,n)},handleHistory:function(e,t,n){Q("handleHistory uri "+e+" mid "+t+" list "+n),"function"==typeof this.onHistory&&this.onHistory(e,t,n)},handlePreFlightCheckResult:function(e,t,n){this.onCheckComplete&&this.onCheckComplete(e,t,n)},handleVoicemail:function(e){this.onVoicemail&&this.onVoicemail(e)},__connectionFailed:function(){x!=n&&this.disconnect()}};var Te=function(e){var t=JSON.parse(e.data),n=t.name,i=t.params;Q("Called local function "+n+" with params "+JSON.stringify(i)),"function"==typeof de[n]?de[n].apply(this,i):Z("Unknown function called: "+n),ce()}.bind(this),Re=function(e,t){return"function"==typeof mozRTCSessionDescription?new mozRTCSessionDescription({type:e,sdp:t}):new RTCSessionDescription({type:e,sdp:t})},Ie=function(e,t,n,i){var o,s,a=e,r=t,l=n,c=i,h=!0;this.id=function(){return a},this.getRemoteParty=function(){return l},this.getState=function(){return r},this.setState=function(e){r=e},this.getDisplayName=function(){return c},this.setPeerConnection=function(e){console.log("Set peer connection: "+e),o=e},this.getPeerConnection=function(){return console.log("Get peer connection: "+o),o},this.setHeaders=function(e){s=e},this.getHeaders=function(){return s},this.streamsAreActive=function(){return h},this.setStreamsActive=function(e){h=e,K[a]&&K[a].setStreamsActive(e)},this.getVideoElementId=function(){return o.getVideoElementId()},this.canStartSendingCandidates=function(){o.canStartSendingCandidates()},this.notifyICETimeout=function(){ne(a)}},Ee=function(e,t){function n(){null===ne&&(ne=setTimeout(function(){ne=null,oe.length>0&&he(l,"voximplant","sdpfrag",JSON.stringify(oe),{}),oe=[]},100))}function i(e,t){oe.push([t,e]),ee&&n()}var o=null,s=!1,a=null;t&&(a=Se);var r=new p(a,{optional:[{DtlsSrtpKeyAgreement:"true"}]}),l=e,c=t;this.isDirect=function(){return c};var d,u=function(e){Z("PC ["+l+"]: "+e)},g=function(e){Q("PC ["+l+"]: "+e)},v=function(e){Z("PC ["+l+"] ERROR: "+e)};this.setCall=function(e){d=e},this.getCall=function(){return d};var y,S;if(y=P(),y.id="vi_audio_"+l,y.volume=X,document.body.appendChild(y),F){S=b(),S.id="vi_video_"+l,S.width=400,S.height=300,S.volume=X;var T=I?document.getElementById(I):document.body;T.appendChild(S)}var R=null,E=null,w=!1,O=!1,A=null,D=null,V=null,x=!1,H=!0,j=null,G=function(){d&&d.notifyICETimeout()}.bind(this);this.getStats=function(e){V&&A&&r.getStats(function(e){var t=e.result();for(var n in t)"ssrc"==t[n].type&&(t[n].local==t[n]||!t[n].remote,t[n].remote==t[n]||!t[n].local)})},this.getRemoteAudioStream=function(){return A},this.getRemoteVideoStream=function(){return D},this.getVideoElementId=function(){return S?S.id:null},this.setLocalStream=function(e){if(!x&&(V&&(r.removeStream(V),V=null),e)){V=e;{"undefined"==typeof e.getAudioTracks?e.audioTracks:e.getAudioTracks(),"undefined"==typeof e.getVideoTracks?e.videoTracks:e.getVideoTracks()}V=e,r.addStream(V),L(V.getAudioTracks(),!z),L(V.getVideoTracks(),W)}};var q=function(e){e&&(j=e,r.addStream(j))};this.setScreenSharingStream=function(e){j=e},this.addScreenSharing=function(e){x||(j&&(r.removeStream(j),j=null),q(e))},this.onIncomingCall=function(e){x||(R=Re("offer",e),r.setRemoteDescription(R,function(){},v))},this.onConnectionConnected=function(e){x||c&&(R=Re("answer",e),r.setRemoteDescription(R,function(){o=setTimeout(G,h)},v))},this.outgoingCall=function(){x||r.createOffer(function(e){E=e,r.setLocalDescription(Re("offer",e.sdp),function(){B()},v)},v)};var B=function(){x||we("createCall",[-1,d.getRemoteParty(),!1,e,null,null,d.getHeaders(),"",E.sdp])};this.createAnswer=function(){x||(g("Calling createAnswer"),r.createAnswer(J,v))};var J=function(e){x||(w=-1!=e.sdp.indexOf("a=rtcp-mux"),r.setLocalDescription(e,function(){E=e,O=!0,K()},v))}.bind(this),K=function(){x||(o=setTimeout(G,h),u("Sending local answer"),g("Local answer: "+E.sdp),c?we("acceptCall",[l,ie(d.getHeaders()),E.sdp]):we("__confirmPC",[l,E.sdp]))},$=!1,Y=function(){$||($=!0)},ee=!1,ne=null,oe=[],se=null,ae=null,re=null;this.canStartSendingCandidates=function(){ee=!0,n()},this.addRemoteCandidate=function(e,t){r.addIceCandidate(new C({candidate:t.substring(2),sdpMLineIndex:e}),function(){console.log("Added ice candidate")},function(e){g("error adding ice candidate "+e)})};var le=function(e){if(!x)if(e.candidate){g("ICE candidate: "+e.candidate.candidate);var t=e.candidate.candidate,n=t;-1==n.indexOf("a=")&&(n="a="+n),m&&E&&(E.sdp+=n,E.sdp+="\r\n"),c?i(n,e.candidate.sdpMLineIndex):we("__addCandidate",[l,n,e.candidate.sdpMLineIndex])}else u("End of candidates."),Y()};this.setRemoteSDP=function(e,t,n){"string"==typeof n&&(se=n),r.setRemoteDescription(Re(e?"offer":"answer",t),function(){e?r.createAnswer(function(e){r.setLocalDescription(e,function(){he(l,"vi","sdpanswer",e.sdp,null),s=!1},function(e){})},function(e){u("Error: "+e)}):s=!1},function(e){u("Error: "+e)})};var ce=function(){return x?void u("Renegotiation requested on closed PeerConnection"):null===E?void u("Renegotiation needed, but no local SD, skipping"):"connected"!=r.iceConnectionState&&"completed"!=r.iceConnectionState?(u("Renegotiation requested while ice state is "+r.iceConnectionState+". Postponing"),void setTimeout(ce,100)):s?void u("Renegotiation in progress. Queueing"):(u("Renegotiation started"),s=!0,void(c?r.createOffer(function(e){u("New SDP: "+e.sdp),r.setLocalDescription(e,function(){var t={};j&&(t["X-ScreenStreamId"]=j.id),he(l,"vi","sdpoffer",e.sdp,t)},function(e){u("Error: "+e)})},function(e){u("ERROR: "+e)}):r.setRemoteDescription(R,function(){return x?void(s=!1):void r.createAnswer(function(e){return x?void(s=!1):(E=e,void r.setLocalDescription(E,function(){s=!1,u("Renegotiation successful")},function(e){s=!1,u("ERROR: "+e)}))},function(e){s=!1,u("ERROR: "+e)})},function(e){s=!1,u("ERROR: "+e)})))},de=function(e){var t=U(e.stream).length>0,n=e.stream.id==se;if(u("Remote stream added "+e.stream.id+" "+(t?"video":"audio")),n){if(null==re){re=b(),re.id="vi_ss_"+l,re.width=400,re.height=300,re.volume=0;var i=I?document.getElementById(I):document.body;i.appendChild(re)}ae=e.stream,f(re,e.stream),te(l,re.id)}else t?D=e.stream:A=e.stream,t?S&&f(S,e.stream):f(y,e.stream),this.setStreamsActive(H)},ue=function(e){},fe=function(e){if("stable"==r.signalingState&&null!=j){var t=r.getLocalStreams();for(var n in t)if(t[n]==j)return;q(j)}};this.setPlaybackVolume=function(e){y&&(y.volume=e),S&&(S.volume=e)},this.streamsAreActive=function(){return H},this.setStreamsActive=function(e){H=e,L(_(A),e&&!k),L(_(D),e&&!k),L(U(D),e),we("__muteLocal",[l,!e])}.bind(this),this.updateMicrophoneMuteState=function(){},this.updateSpeakerMuteState=function(){A&&L(_(A),H&&!k)},this.activateStreams=function(){x||this.setStreamsActive(!0)},this.deactivateStreams=function(){x||this.setStreamsActive(!1)},r.onicecandidate=le.bind(this),r.onaddstream=de.bind(this),r.onnegotiationneeded=ce.bind(this),r.onremovestream=ue.bind(this),r.onsignalingstatechange=fe.bind(this),r.oniceconnectionstatechange=function(){("completed"==r.iceConnectionState||"connected"==r.iceConnectionState&&o)&&(clearTimeout(o),o=null)}.bind(this),this.close=function(){x=!0,r.close(),y&&(y.parentNode.removeChild(y),M(y)),S&&(S.parentNode.removeChild(S),N(S)),re&&(re.parentNode.removeChild(re),N(re))},this.start=function(e){x||(R=Re("offer",e),r.setRemoteDescription(R,function(){r.createAnswer(function(e){console.log("Local answer created: "+e.sdp),w=-1!=e.sdp.indexOf("a=rtcp-mux"),r.setLocalDescription(e,function(){E=e,O=!0,K()},v)},v)},v))}},we=function(e,t){Q("Called remote function "+e+" with params "+JSON.stringify(t)),V?V.send(JSON.stringify({name:e,params:t})):Z("ERROR: can't call remote function when not connected"),ce()}}}(n),function(e,t){e.Config={},e.FlashVideoSettings={},e.VideoSettings={},e.AudioSourceInfo={},e.VideoSourceInfo={},e.NetworkInfo={},e.SubscriptionRequestType={Subscribe:0,Unsubscribe:1},e.ChatStateType={Active:1,Composing:2,Paused:4,Inactive:8,Gone:16,Invalid:32},e.MessageEventType={Offline:1,Delivered:2,Displayed:4,Composing:8,Invalid:16,Cancel:32},e.RosterItemEvent={Added:0,Removed:1,Updated:2,Subscribed:3,Unsubscribed:4},e.UserStatuses={Online:0,Chat:1,Away:2,DND:3,XA:4,Offline:5},e.OperatorACDStatuses={Offline:"OFFLINE",Online:"ONLINE",Ready:"READY",InService:"IN_SERVICE",AfterService:"AFTER_SERVICE",Timeout:"TIMEOUT",DND:"DND"},e.IMErrorType={RemoteFunctionError:"RemoteFunctionError",Error:"Error",RosterError:"RosterError"},e.LoginOptions={},e.RosterItem={}}(n),function(e,t){e.Events={SDKReady:"SDKReady",ConnectionEstablished:"ConnectionEstablished",ConnectionFailed:"ConnectionFailed",ConnectionClosed:"ConnectionClosed",AuthResult:"AuthResult",PlaybackFinished:"PlaybackFinished",MicAccessResult:"MicAccessResult",IncomingCall:"IncomingCall",SourcesInfoUpdated:"SourcesInfoUpdated",NetStatsReceived:"NetStatsReceived",IMError:"IMError"},e.CallEvents={Connected:"Connected",Disconnected:"Disconnected",Failed:"Failed",ProgressToneStart:"ProgressToneStart",ProgressToneStop:"ProgressToneStop",MessageReceived:"MessageReceived",InfoReceived:"InfoReceived",TransferComplete:"TransferComplete",TransferFailed:"TransferFailed",RemoteScreenCaptureStarted:"RemoteScreenCaptureStarted",ICETimeout:"ICETimeout"},e.IMEvents={RosterReceived:"RosterReceived",RosterItemChange:"RosterItemChange",RosterPresenceUpdate:"RosterPresenceUpdate",PresenceUpdate:"PresenceUpdate",MessageReceived:"MessageReceived",ChatStateUpdate:"ChatStateUpdate",MessageStatus:"MessageStatus",SubscriptionRequest:"SubscriptionRequest",ChatRoomCreated:"ChatRoomCreated",ChatRoomSubjectChange:"ChatRoomSubjectChange",ChatRoomInfo:"ChatRoomInfo",ChatRoomMessageReceived:"ChatRoomMessageReceived",ChatRoomInvitation:"ChatRoomInvitation",ChatRoomInviteDeclined:"ChatRoomInviteDeclined",ChatRoomPresenceUpdate:"ChatRoomPresenceUpdate",ChatRoomsDataReceived:"ChatRoomsDataReceived"}}(n),function(e,t){e.Call=function(e,t,n,i,o,s){var a=o,r=e,l=t,c=n,h=i,d=s;this.eventListeners={},this.call=function(e){return"undefined"==typeof e?r:void(r=e)},this.__number=function(e){return"undefined"==typeof e?l:void(l=e)},this.__displayName=function(){return c},this.__headers=function(){return h},this.RTC=function(){return a},this.zingayaAPI=function(){return d}},e.Call.prototype={id:function(){return this.call()},number:function(){return this.__number()},displayName:function(){return this.__displayName()},headers:function(){return this.__headers()},active:function(){return this.RTC()?this.zingayaAPI().isCallActive(this.call()):e.Utils.swfMovie("voximplantSWF").isCallActive(this.call())},state:function(){if(this.RTC())return this.zingayaAPI().getCallState(this.call());var t=e.Utils.swfMovie("voximplantSWF").getCallState(this.call()).toUpperCase();switch(t){case"CONNECTING":t=e.VI_CALL_STATE_ALERTING;break;case"CONNECTED_ON_HOLD":t=e.VI_CALL_STATE_CONNECTED;break;case"DISCONNECTED":case"FAILED":t=e.VI_CALL_STATE_ENDED}return t},answer:function(t,n){if("undefined"!=typeof t&&("undefined"==typeof n&&(n={}),n["VI-CallData"]=t),this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_ALERTING)throw new Error("NO_INCOMING_CALL");this.zingayaAPI().answerCall(this.call(),n)}else n=JSON.stringify(n),e.Utils.swfMovie("voximplantSWF").accept(this.call(),n)},decline:function(t){if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_ALERTING)throw new Error("NO_INCOMING_CALL");this.zingayaAPI().rejectCall(this.call(),486,t)}else t=e.Utils.stringifyExtraHeaders(t),e.Utils.swfMovie("voximplantSWF").reject(this.call(),t)},reject:function(e){this.decline(e)},hangup:function(t){if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_CONNECTED&&this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_PROGRESSING)throw new Error("WRONG_CALL_STATE");this.zingayaAPI().hangupCall(this.call(),t)}else t=e.Utils.stringifyExtraHeaders(t),e.Utils.swfMovie("voximplantSWF").disconnectCall(this.call(),t)},sendTone:function(t){if("*"==t)t=10;else if("#"==t)t=11;else if(t=parseInt(t),0>t||t>9)throw new Error("WRONG_TONE_INPUT");if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_CONNECTED)throw new Error("CALL_NOT_CONNECTED");

this.zingayaAPI().sendDigit(this.call(),t)}else e.Utils.swfMovie("voximplantSWF").sendDTMF(t,this.call())},mutePlayback:function(){this.RTC()?this.zingayaAPI().mutePlayback(!0):e.Utils.swfMovie("voximplantSWF").muteIncomingAudio(this.call())},muteMicrophone:function(){this.RTC()?this.zingayaAPI().muteMicrophone(!0):e.Utils.swfMovie("voximplantSWF").muteOutgoingAudio(this.call())},unmutePlayback:function(){this.RTC()?this.zingayaAPI().mutePlayback(!1):e.Utils.swfMovie("voximplantSWF").unmuteIncomingAudio(this.call())},unmuteMicrophone:function(){this.RTC()?this.zingayaAPI().muteMicrophone(!1):e.Utils.swfMovie("voximplantSWF").unmuteOutgoingAudio(this.call())},showRemoteVideo:function(t){"undefined"==typeof t&&(t=!0),this.RTC()?document.getElementById(this.zingayaAPI().getVideoElementId(this.call())).style.display=t?"block":"none":e.Utils.swfMovie("voximplantSWF").showRemoteVideo(this.call(),t)},setRemoteVideoPosition:function(t,n){if(this.RTC())throw new Error("Please use CSS to position '#voximplantcontainer' element");e.Utils.swfMovie("voximplantSWF").setRemoteViewPosition(this.call(),t,n)},setRemoteVideoSize:function(t,n){if(this.RTC())throw new Error("Please use CSS to set size of '#voximplantcontainer' element");e.Utils.swfMovie("voximplantSWF").setRemoteViewSize(this.call(),t,n)},sendInfo:function(t,n,i){var o,s,a=t.indexOf("/");if(-1==a?(o="application",s=t):(o=t.substring(0,a),s=t.substring(a+1)),this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_CONNECTED)throw new Error("CALL_NOT_CONNECTED");this.zingayaAPI().sendSIPInfo(this.call(),o,s,n,i)}else i=e.Utils.stringifyExtraHeaders(i),e.Utils.swfMovie("voximplantSWF").sendSIPInfo(this.call(),o,s,n,i)},sendMessage:function(t){if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_CONNECTED)throw new Error("CALL_NOT_CONNECTED");this.zingayaAPI().sendInstantMessage(this.call(),t)}else e.Utils.swfMovie("voximplantSWF").sendMessage(this.call(),t)},setVideoSettings:function(t,n,i){this.RTC()?this.zingayaAPI().setConstraints(t,n,i,!0):this.useRTCOnly||("[object Object]"==Object.prototype.toString.call(t)&&(t=JSON.stringify(t)),e.Utils.swfMovie("voximplantSWF").setVideoSettings(t,this.call()))},getIncomingStreamInfo:function(){if(this.RTC());else if(!this.useRTCOnly)return JSON.parse(e.Utils.swfMovie("voximplantSWF").getIncomingStreamInfo(this.call()))},getOutgoingStreamInfo:function(){if(this.RTC());else if(!this.useRTCOnly)return JSON.parse(e.Utils.swfMovie("voximplantSWF").getOutgoingStreamInfo(this.call()))},getVideoElementId:function(){return this.RTC()?this.zingayaAPI().getVideoElementId(this.call()):void 0}},e.Call.prototype.addEventListener=function(e,t){"undefined"==typeof this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.Call.prototype.removeEventListener=function(e,t){if("undefined"!=typeof this.eventListeners[e])for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}}}(n),function(e,t){e.Client=function(){this.config=null,this.calls=[];var n=e.Call;delete e.Call;var i=!1;this.eventListeners={},this.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"},this.playingNow=!1,this.serversList=[];var o=100;this.audioSourcesList=[],this.videoSourcesList=[],this.deviceEnumAPI="undefined"!=typeof MediaStreamTrack&&"undefined"!=typeof MediaStreamTrack.getSources,this.gotSources=function(e){0!==this.audioSourcesList.length&&(this.audioSourcesList=[]),0!==this.videoSourcesList.length&&(this.videoSourcesList=[]);for(var t=0,n=0,i=0;i!=e.length;++i){var o=e[i];"audio"===o.kind?(n++,this.audioSourcesList.push({id:o.id,name:o.label||"Audio recording device "+n})):"video"===o.kind&&(t++,this.videoSourcesList.push({id:o.id,name:o.label||"Video recording device "+t}))}this.dispatchEvent({name:"SourcesInfoUpdated"})}.bind(this),this.__init=function(i){function o(){if(this.dispatchEvent({name:"SDKReady",version:e.version}),-1!=navigator.userAgent.indexOf("Safari")){var t=document.getElementById(this.swfContainer);null!==t&&(t.style.minWidth=t.style.width="215px")}for(var n=JSON.parse(e.Utils.swfMovie("voximplantSWF").audioSources()),i=JSON.parse(e.Utils.swfMovie("voximplantSWF").videoSources()),o=0;o<n.length;o++)this.audioSourcesList.push({id:o,name:n[o]});for(o=0;o<i.length;o++)this.videoSourcesList.push({id:o,name:i[o]});this.dispatchEvent({name:"SourcesInfoUpdated"})}if(null!==this.config)throw"VoxImplant.Client has been already initialized";if(this.config="undefined"!=typeof i?i:{},this.useFlashOnly=this.config.useFlashOnly===!0?!0:!1,this.useRTCOnly=this.config.useRTCOnly===!0?!0:!1,this.RTCsupported=!1,this.micRequired=this.config.micRequired!==!1?!0:!1,this.videoSupport=this.config.videoSupport!==!0?!1:!0,this.videoConstraints="undefined"!=typeof this.config.videoConstraints?this.config.videoConstraints:{},this.swfContainer="undefined"!=typeof this.config.swfContainer?this.config.swfContainer:null,this.progressToneCountry="undefined"!=typeof this.config.progressToneCountry?this.config.progressToneCountry:"US",this.progressTone=this.config.progressTone!==!0?!1:!0,this.showFlashSettings=this.config.showFlashSettings===!0?!0:!1,"undefined"!=typeof this.config.serverIp&&(this.serverIp=this.config.serverIp),"undefined"!=typeof this.config.swfURL&&(this.swfURL=this.config.swfURL),this.showDebugInfo="undefined"!=typeof this.config.showDebugInfo?this.config.showDebugInfo:!0,this.imXSSprotection="undefined"!=typeof this.config.imXSSprotection?this.config.imXSSprotection:!0,this.imAutoReconnect="undefined"!=typeof this.config.imAutoReconnect?this.config.imAutoReconnect:!0,this.imReconnectInterval="undefined"!=typeof this.config.imReconnectInterval?this.config.imReconnectInterval>=2e3?this.config.imReconnectInterval:2e3:3e3,this.imReconnectTs=0,"undefined"!=typeof webkitRTCPeerConnection||"undefined"!=typeof mozRTCPeerConnection)if("undefined"!=typeof mozRTCPeerConnection)try{{new mozRTCPeerConnection({iceServers:[]})}this.RTCsupported=!0}catch(s){}else this.RTCsupported=!0;var a;if(this.RTCsupported&&!this.useFlashOnly)this.zingayaAPI=new e.ZingayaAPI(this.videoSupport,this.micRequired),delete e.ZingayaAPI,this.zingayaAPI.onConnectionEstablished=function(){this.connectionState(!0),this.dispatchEvent({name:"ConnectionEstablished"})}.bind(this),this.zingayaAPI.onConnectionFailed=function(e){this.serversList.length>1&&"undefined"==typeof this.serverIp?(this.serversList.splice(0,1),this.connectTo(this.serversList[0],!0)):this.dispatchEvent({name:"ConnectionFailed",message:e})}.bind(this),this.zingayaAPI.onConnectionClosed=function(){this.connectionState(!1),this.__cleanup(),this.dispatchEvent({name:"ConnectionClosed"}),this.progressTone&&this.stopProgressTone()}.bind(this),this.zingayaAPI.onLoginSuccessful=function(e,t){this.dispatchEvent({name:"AuthResult",result:!0,displayName:e,options:t})}.bind(this),this.zingayaAPI.onLoginFailed=function(e){this.dispatchEvent({name:"AuthResult",result:!1,code:e.errorCode,key:e.oneTimeKey})}.bind(this),this.zingayaAPI.onCallConnected=function(e,t){this.getCall(e).dispatchEvent({name:"Connected",call:this.getCall(e),headers:t}),this.progressTone&&this.stopProgressTone()}.bind(this),this.zingayaAPI.onCallEnded=function(e,t){this.getCall(e).dispatchEvent({name:"Disconnected",call:this.getCall(e),headers:t}),this.removeCall(e),this.progressTone&&this.stopProgressTone()}.bind(this),this.zingayaAPI.onCallFailed=function(e,t,n,i){this.getCall(e).dispatchEvent({name:"Failed",call:this.getCall(e),code:t,reason:n,headers:i}),this.removeCall(e),this.progressTone&&this.stopProgressTone()}.bind(this),this.zingayaAPI.onMediaAccessGranted=function(){this.deviceEnumAPI&&MediaStreamTrack.getSources(this.gotSources),this.micRequired&&this.zingayaAPI.connectTo(this.host,"platform"),this.dispatchEvent({name:"MicAccessResult",result:!0})}.bind(this),this.zingayaAPI.onMediaAccessRejected=function(e){this.dispatchEvent({name:"MicAccessResult",result:!1,reason:e})}.bind(this),this.zingayaAPI.onIncomingCall=function(e,t,i,o){var s=new n(e,t,i,o,!0,this.zingayaAPI);this.calls.length>0&&this.zingayaAPI.setCallActive(e,!1),this.calls.push(s),this.dispatchEvent({name:"IncomingCall",call:s,headers:o})}.bind(this),this.zingayaAPI.onCallRinging=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStart",call:this.getCall(e)}),this.progressTone&&this.playProgressTone()}.bind(this),this.zingayaAPI.onCallMediaStarted=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStop",call:this.getCall(e)}),this.progressTone&&this.stopProgressTone()}.bind(this),this.zingayaAPI.onRemoteScreenCaptureStarted=function(e,t){this.getCall(e).dispatchEvent({name:"RemoteScreenCaptureStarted",call:this.getCall(e),videoElementId:t})}.bind(this),this.zingayaAPI.onInstantMessageReceived=function(e,t){this.getCall(e).dispatchEvent({name:"MessageReceived",call:this.getCall(e),text:t})}.bind(this),this.zingayaAPI.onSIPInfoReceived=function(e,t,n,i){this.getCall(e).dispatchEvent({name:"InfoReceived",call:this.getCall(e),mimeType:t,body:n,headers:i})}.bind(this),this.zingayaAPI.onTransferComplete=function(e){this.getCall(e).dispatchEvent({name:"TransferComplete",call:this.getCall(e)})}.bind(this),this.zingayaAPI.onTransferFailed=function(e){this.getCall(e).dispatchEvent({name:"TransferFailed",call:this.getCall(e)})}.bind(this),this.zingayaAPI.onNetStatsReceived=function(e){this.dispatchEvent({name:"NetStatsReceived",stats:e})}.bind(this),this.zingayaAPI.onHandleRoster=function(e,t){this.dispatchEvent({name:"RosterReceived",id:e,roster:t})}.bind(this),this.zingayaAPI.onHandleRosterItem=function(e,t,n,i){this.dispatchEvent({name:"RosterItemChange",id:e,resource:t,type:n,displayName:i})}.bind(this),this.zingayaAPI.onHandleRosterPresence=function(e,t,n,i){this.dispatchEvent({name:"RosterPresenceUpdate",id:e,resource:t,presence:n,message:i})}.bind(this),this.zingayaAPI.onHandleMessage=function(e,t,n,i){if(this.imXSSprotection){var o=document.createElement("div");o.appendChild(document.createTextNode(n.replace(/\s/g," "))),n=o.innerHTML}this.dispatchEvent({name:"MessageReceived",id:e,resource:t,content:n,message_id:i})}.bind(this),this.zingayaAPI.onHandleSelfPresence=function(e,t,n,i){this.dispatchEvent({name:"PresenceUpdate",id:e,resource:t,presence:n,message:i})}.bind(this),this.zingayaAPI.onHandleChatState=function(e,t,n){this.dispatchEvent({name:"ChatStateUpdate",id:e,resource:t,state:n})}.bind(this),this.zingayaAPI.onHandleMessageEvent=function(e,t,n,i){this.dispatchEvent({name:"MessageStatus",id:e,resource:t,type:n,message_id:i})}.bind(this),this.zingayaAPI.onHandleSubscription=function(e,t,n,i){this.dispatchEvent({name:"SubscriptionRequest",id:e,resource:t,type:n,message:i})}.bind(this),this.zingayaAPI.onCallRemoteFunctionError=function(e,t,n,i){this.dispatchEvent({name:"IMError",errorType:"RemoteFunctionError",errorData:{method:e,params:t,code:n,description:i}})}.bind(this),this.zingayaAPI.onIMError=function(e,t,n){this.dispatchEvent({name:"IMError",errorType:"Error",errorData:{type:e,code:t,description:n}})}.bind(this),this.zingayaAPI.onUCConnected=function(){this.imAutoReconnect===!0&&clearInterval(this.imReconnectTs)}.bind(this),this.zingayaAPI.onUCDisconnected=function(){this.imAutoReconnect===!0&&(clearInterval(this.imReconnectTs),this.imReconnectTs=setInterval(function(){this.zingayaAPI.ucReconnect()}.bind(this),this.imReconnectInterval))}.bind(this),this.zingayaAPI.onIMRosterError=function(e){this.dispatchEvent({name:"IMError",errorType:"RosterError",errorData:{code:e}})}.bind(this),this.zingayaAPI.onMUCError=function(e,t,n,i){}.bind(this),this.zingayaAPI.onMUCRoomCreation=function(e){this.dispatchEvent({name:"ChatRoomCreated",room:e})}.bind(this),this.zingayaAPI.onMUCSubject=function(e,t,n){this.dispatchEvent({name:"ChatRoomSubjectChange",room:e,id:t,subject:n})}.bind(this),this.zingayaAPI.onMUCInfo=function(e,t,n,i){this.dispatchEvent({name:"ChatRoomInfo",room:e,features:t,name:n,info:i})}.bind(this),this.zingayaAPI.onMUCMessage=function(e,t,n,i,o,s){if(this.imXSSprotection){var a=document.createElement("div");a.appendChild(document.createTextNode(s.replace(/\s/g," "))),s=a.innerHTML}this.dispatchEvent({name:"ChatRoomMessageReceived",room:e,message_id:t,"private":n,timestamp:i,from:o,content:s})}.bind(this),this.zingayaAPI.onMUCInvitation=function(e,t,n,i,o,s,a){this.dispatchEvent({name:"ChatRoomInvitation",room:e,from:t,reason:n,body:i,password:o,cont:s,thread:a})}.bind(this),this.zingayaAPI.onMUCInviteDecline=function(e,t,n){this.dispatchEvent({name:"ChatRoomInviteDeclined",room:e,invitee:t,reason:n})}.bind(this),this.zingayaAPI.onMUCParticipantPresence=function(e,t,n,i){this.dispatchEvent({name:"ChatRoomPresenceUpdate",room:e,participant:t,presence:n,message:i})}.bind(this),this.zingayaAPI.onMUCRooms=function(e){this.dispatchEvent({name:"ChatRoomsDataReceived",rooms:e})}.bind(this),this.zingayaAPI.onHistory=function(e,t,n){this.dispatchEvent({name:"ChatHistoryReceived",id:e,message_id:t,messages:n})}.bind(this),this.zingayaAPI.onCallICETimeout=function(e){this.getCall(e).dispatchEvent({name:"ICETimeout",call:this.getCall(e)})}.bind(this),this.zingayaAPI.writeLog=function(e){if("function"==typeof this.writeLog)this.writeLog(e);else{var t={year:"numeric",month:"numeric",day:"numeric"};this.showDebugInfo&&console.log("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",t)+" "+e)}}.bind(this),this.zingayaAPI.writeTrace=function(e){if("function"==typeof this.writeTrace)this.writeTrace(e);else{var t={year:"numeric",month:"numeric",day:"numeric"};this.showDebugInfo&&console.log("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",t)+" "+e)}}.bind(this),checkDOMReady=function(){"undefined"!=typeof document&&(clearInterval(a),this.dispatchEvent({name:"SDKReady",version:e.version}),this.deviceEnumAPI&&MediaStreamTrack.getSources(this.gotSources))},a=setInterval(checkDOMReady.bind(this),100);else{if(this.useRTCOnly)throw new Error("NO_WEBRTC_SUPPORT");var r=function(){function e(){if(!X){try{var e=x.getElementsByTagName("body")[0].appendChild(v("span"));e.parentNode.removeChild(e)}catch(t){return}X=!0;for(var n=W.length,i=0;n>i;i++)W[i]()}}function n(e){X?e():W[W.length]=e}function i(e){if(typeof V.addEventListener!=b)V.addEventListener("load",e,!1);else if(typeof x.addEventListener!=b)x.addEventListener("load",e,!1);else if(typeof V.attachEvent!=b)y(V,"onload",e);else if("function"==typeof V.onload){var t=V.onload;V.onload=function(){t(),e()}}else V.onload=e}function o(){k?s():a()}function s(){var e=x.getElementsByTagName("body")[0],t=v(N);t.setAttribute("type",L);var n=e.appendChild(t);if(n){var i=0;!function(){if(typeof n.GetVariable!=b){var o=n.GetVariable("$version");o&&(o=o.split(" ")[1].split(","),J.pv=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10)])}else if(10>i)return i++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,a()}()}else a()}function a(){var e=H.length;if(e>0)for(var t=0;e>t;t++){var n=H[t].id,i=H[t].callbackFn,o={success:!1,id:n};if(J.pv[0]>0){var s=g(n);if(s)if(!S(H[t].swfVersion)||J.wk&&J.wk<312)if(H[t].expressInstall&&c()){var a={};a.data=H[t].expressInstall,a.width=s.getAttribute("width")||"0",a.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(a.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(a.align=s.getAttribute("align"));for(var r={},u=s.getElementsByTagName("param"),f=u.length,p=0;f>p;p++)"movie"!=u[p].getAttribute("name").toLowerCase()&&(r[u[p].getAttribute("name")]=u[p].getAttribute("value"));h(a,r,n,i)}else d(s),i&&i(o);else R(n,!0),i&&(o.success=!0,o.ref=l(n),i(o))}else if(R(n,!0),i){var C=l(n);C&&typeof C.SetVariable!=b&&(o.success=!0,o.ref=C),i(o)}}}function l(e){var t=null,n=g(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=b)t=n;else{var i=n.getElementsByTagName(N)[0];i&&(t=i)}return t}function c(){return!q&&S("6.0.65")&&(J.win||J.mac)&&!(J.wk&&J.wk<312)}function h(e,t,n,i){q=!0,O=i||null,A={success:!1,id:n};var o=g(n);if(o){"OBJECT"==o.nodeName?(E=u(o),w=null):(E=o,w=n),e.id=F,(typeof e.width==b||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==b||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),x.title=x.title.slice(0,47)+" - Flash Player Installation";var s=J.ie&&J.win?"ActiveX":"PlugIn",a="MMredirectURL="+V.location.toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+x.title;if(typeof t.flashvars!=b?t.flashvars+="&"+a:t.flashvars=a,J.ie&&J.win&&4!=o.readyState){var r=v("div");n+="SWFObjectNew",r.setAttribute("id",n),o.parentNode.insertBefore(r,o),o.style.display="none",function(){4==o.readyState?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}f(e,t,n)}}function d(e){if(J.ie&&J.win&&4!=e.readyState){var t=v("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=v("div");if(J.win&&J.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(N)[0];if(n){var i=n.childNodes;if(i)for(var o=i.length,s=0;o>s;s++)1==i[s].nodeType&&"PARAM"==i[s].nodeName||8==i[s].nodeType||t.appendChild(i[s].cloneNode(!0))}}return t}function f(e,t,n){var i,o=g(n);if(J.wk&&J.wk<312)return i;if(o)if(typeof e.id==b&&(e.id=n),J.ie&&J.win){var s="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?s+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(s+=" "+a+'="'+e[a]+'"'));var r="";for(var l in t)t[l]!=Object.prototype[l]&&(r+='<param name="'+l+'" value="'+t[l]+'" />');o.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+r+"</object>",j[j.length]=e.id,i=g(e.id)}else{var c=v(N);c.setAttribute("type",L);for(var h in e)e[h]!=Object.prototype[h]&&("styleclass"==h.toLowerCase()?c.setAttribute("class",e[h]):"classid"!=h.toLowerCase()&&c.setAttribute(h,e[h]));for(var d in t)t[d]!=Object.prototype[d]&&"movie"!=d.toLowerCase()&&p(c,d,t[d]);o.parentNode.replaceChild(c,o),i=c}return i}function p(e,t,n){var i=v("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}function C(e){var t=g(e);t&&"OBJECT"==t.nodeName&&(J.ie&&J.win?(t.style.display="none",function(){4==t.readyState?m(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function m(e){var t=g(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function g(e){var t=null;try{t=x.getElementById(e)}catch(n){}return t}function v(e){return x.createElement(e)}function y(e,t,n){e.attachEvent(t,n),G[G.length]=[e,t,n]}function S(e){var t=J.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function T(e,t,n,i){if(!J.ie||!J.mac){var o=x.getElementsByTagName("head")[0];if(o){var s=n&&"string"==typeof n?n:"screen";if(i&&(P=null,M=null),!P||M!=s){var a=v("style");a.setAttribute("type","text/css"),a.setAttribute("media",s),P=o.appendChild(a),J.ie&&J.win&&typeof x.styleSheets!=b&&x.styleSheets.length>0&&(P=x.styleSheets[x.styleSheets.length-1]),M=s}J.ie&&J.win?P&&typeof P.addRule==N&&P.addRule(e,t):P&&typeof x.createTextNode!=b&&P.appendChild(x.createTextNode(e+" {"+t+"}"))}}}function R(e,t){if(B){var n=t?"visible":"hidden";X&&g(e)?g(e).style.visibility=n:T("#"+e,"visibility:"+n)}}function I(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=b?encodeURIComponent(e):e}{var E,w,O,A,P,M,b="undefined",N="object",_="Shockwave Flash",U="ShockwaveFlash.ShockwaveFlash",L="application/x-shockwave-flash",F="SWFObjectExprInst",D="onreadystatechange",V=window,x=document,z=navigator,k=!1,W=[o],H=[],j=[],G=[],X=!1,q=!1,B=!0,J=function(){var e=typeof x.getElementById!=b&&typeof x.getElementsByTagName!=b&&typeof x.createElement!=b,t=z.userAgent.toLowerCase(),n=z.platform.toLowerCase(),i=/win/.test(n?n:t),o=/mac/.test(n?n:t),s=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,a=!1,r=[0,0,0],l=null;if(typeof z.plugins!=b&&typeof z.plugins[_]==N)l=z.plugins[_].description,!l||typeof z.mimeTypes!=b&&z.mimeTypes[L]&&!z.mimeTypes[L].enabledPlugin||(k=!0,a=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),r[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),r[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),r[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof V.ActiveXObject!=b)try{var c=new ActiveXObject(U);c&&(l=c.GetVariable("$version"),l&&(a=!0,l=l.split(" ")[1].split(","),r=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(h){}return{w3:e,pv:r,wk:s,ie:a,win:i,mac:o}}();!function(){J.w3&&((typeof x.readyState!=b&&"complete"==x.readyState||typeof x.readyState==b&&(x.getElementsByTagName("body")[0]||x.body))&&e(),X||(typeof x.addEventListener!=b&&x.addEventListener("DOMContentLoaded",e,!1),J.ie&&J.win&&(x.attachEvent(D,function(){"complete"==x.readyState&&(x.detachEvent(D,arguments.callee),e())}),V==top&&!function(){if(!X){try{x.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),J.wk&&!function(){return X?void 0:/loaded|complete/.test(x.readyState)?void e():void setTimeout(arguments.callee,0)}(),i(e)))}(),function(){J.ie&&J.win&&window.attachEvent("onunload",function(){for(var e=G.length,t=0;e>t;t++)G[t][0].detachEvent(G[t][1],G[t][2]);for(var n=j.length,i=0;n>i;i++)C(j[i]);for(var o in J)J[o]=null;J=null;for(var s in r)r[s]=null;r=null})}()}return{registerObject:function(e,t,n,i){if(J.w3&&e&&t){var o={};o.id=e,o.swfVersion=t,o.expressInstall=n,o.callbackFn=i,H[H.length]=o,R(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){return J.w3?l(e):void 0},embedSWF:function(e,t,i,o,s,a,r,l,d,u){var p={success:!1,id:t};J.w3&&!(J.wk&&J.wk<312)&&e&&t&&i&&o&&s?(R(t,!1),n(function(){i+="",o+="";var n={};if(d&&typeof d===N)for(var C in d)n[C]=d[C];n.data=e,n.width=i,n.height=o;var m={};if(l&&typeof l===N)for(var g in l)m[g]=l[g];if(r&&typeof r===N)for(var v in r)typeof m.flashvars!=b?m.flashvars+="&"+v+"="+r[v]:m.flashvars=v+"="+r[v];if(S(s)){var y=f(n,m,t);n.id==t&&R(t,!0),p.success=!0,p.ref=y}else{if(a&&c())return n.data=a,void h(n,m,t,u);R(t,!0)}u&&u(p)})):u&&u(p)},switchOffAutoHideShow:function(){B=!1},ua:J,getFlashPlayerVersion:function(){return{major:J.pv[0],minor:J.pv[1],release:J.pv[2]}},hasFlashPlayerVersion:S,createSWF:function(e,n,i){return J.w3?f(e,n,i):t},showExpressInstall:function(e,t,n,i){J.w3&&c()&&h(e,t,n,i)},removeSWF:function(e){J.w3&&C(e)},createCSS:function(e,t,n,i){J.w3&&T(e,t,n,i)},addDomLoadEvent:n,addLoadEvent:i,getQueryParamValue:function(e){var t=x.location.search||x.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return I(t);for(var n=t.split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return I(n[i].substring(n[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(q){var e=g(F);e&&E&&(e.parentNode.replaceChild(E,e),w&&(R(w,!0),J.ie&&J.win&&(E.style.display="block")),O&&O(A)),q=!1}}}}();if(createContainer=function(){if("undefined"!=typeof document){var e;if(clearInterval(a),null!==this.swfContainer){if(e=document.getElementById(this.swfContainer),null===e)throw new Error("NO_SWF_CONTAINER");e.offsetWidth<215&&(e.style.minWidth=e.style.width="215px"),e.offsetHeight<138&&(e.style.minHeight=e.style.height="138px")}else e=document.createElement("div"),this.swfContainer=e.id="voximplantcontainer",e.style.minWidth=e.style.width="215px",e.style.minHeight=e.style.height="138px",document.body.firstChild?document.body.insertBefore(e,document.body.firstChild):document.body.appendChild(e);-1!=navigator.userAgent.indexOf("Safari")&&(e.style.minWidth=e.style.width="310px");var t=document.createElement("div");t.id="voximplantcontainerSWF",e.appendChild(t);var n={id:"voximplantSWF",name:"voximplantSWF"},i=!1,s={allowScriptAccess:"always",wmode:"window",allowFullScreen:"true"};window.voxImplantFlashAPIReady=o.bind(this);var l=("https:"==document.location.protocol?"https://":"http://")+"cdn.voximplant.com/VoxImplant-3.0.swf?ver=080515";"undefined"!=typeof this.swfURL&&(l=this.swfURL),r.embedSWF(l,"voximplantcontainerSWF","100%","100%","11.3","http://cdn.voximplant.com/expressInstall.swf",i,s,n)}},!r.hasFlashPlayerVersion("11.3"))throw new Error("OLD_FLASH_VERSION");a=setInterval(createContainer.bind(this),100)}window.VILog=function(e){if("function"==typeof this.writeLog)this.writeLog(e);else{var t={year:"numeric",month:"numeric",day:"numeric"};this.showDebugInfo&&"undefined"!=typeof console&&console.log("VI FLASH: "+(new Date).toLocaleTimeString("en-US",t)+" "+e)}}.bind(this),window.VIConnectionEstablished=function(){this.connectionState(!0),this.dispatchEvent({name:"ConnectionEstablished"})}.bind(this),window.VIConnectionFailed=function(){this.serversList.length>1&&"undefined"==typeof this.serverIp?(this.serversList.splice(0,1),this.connectTo(this.serversList[0],!0)):this.dispatchEvent({name:"ConnectionFailed"})}.bind(this),window.VIConnectionClosed=function(){this.connectionState(!1),this.__cleanup(),this.dispatchEvent({name:"ConnectionClosed"}),this.progressTone&&this.stopProgressTone()}.bind(this),window.VIAuthFailed=function(e,t){this.dispatchEvent({name:"AuthResult",result:!1,code:e,key:t})}.bind(this),window.VIAuthSuccessful=function(e,t){"string"==typeof t&&(t=JSON.parse(t)),this.dispatchEvent({name:"AuthResult",result:!0,displayName:e,options:t})}.bind(this),window.VICallConnected=function(e,t){this.getCall(e).dispatchEvent({name:"Connected",call:this.getCall(e),headers:null!==t?JSON.parse(t):{}}),this.progressTone&&this.stopProgressTone()}.bind(this),window.VICallDisconnected=function(e,t){this.getCall(e).dispatchEvent({name:"Disconnected",call:this.getCall(e),headers:null!==t?JSON.parse(t):{}}),this.removeCall(e),this.progressTone&&this.stopProgressTone()}.bind(this),window.VICallFailed=function(e,t,n,i){this.getCall(e).dispatchEvent({name:"Failed",call:this.getCall(e),code:t,reason:n,headers:null!==i?JSON.parse(i):{}}),this.removeCall(e),this.progressTone&&this.stopProgressTone()}.bind(this),window.VIMicAccessResult=function(e){this.dispatchEvent({name:"MicAccessResult",result:e})}.bind(this),window.VIProgressToneStart=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStart",call:this.getCall(e)}),this.progressTone&&this.playProgressTone()}.bind(this),window.VIProgressToneStop=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStop",call:this.getCall(e)}),this.progressTone&&this.stopProgressTone()}.bind(this),window.VIIncomingCall=function(e,t,i,o){var s=new n(e,t,i,null!==o?JSON.parse(o):{},!1);this.calls.length>0&&this.zingayaAPI.setCallActive(e,!1),this.calls.push(s),this.dispatchEvent({name:"IncomingCall",call:s,headers:null!==o?JSON.parse(o):{}})}.bind(this),window.VISIPInfoReceived=function(e,t,n,i,o){"application"==t&&"zingaya-im"==n?this.getCall(e).dispatchEvent({name:"MessageReceived",call:this.getCall(e),text:i}):(null!==o&&(o=JSON.parse(o)),this.getCall(e).dispatchEvent({name:"InfoReceived",call:this.getCall(e),mimeType:t+"/"+n,body:i,headers:o}))}.bind(this),window.VIToneScriptPlaybackStop=function(){this.dispatchEvent({name:"PlaybackFinished"})}.bind(this),window.VITransferComplete=function(e){this.getCall(e).dispatchEvent({name:"TransferComplete",call:this.getCall(e)})}.bind(this),window.VITransferFailed=function(e){this.getCall(e).dispatchEvent({name:"TransferFailed",call:this.getCall(e)})}.bind(this),window.VIPacketLossInfo=function(e){this.dispatchEvent({name:"NetStatsReceived",stats:{packetLoss:e}})}.bind(this),window.VIHandleRoster=function(e,t){this.dispatchEvent({name:"RosterReceived",id:e,roster:JSON.parse(t)})}.bind(this),window.VIHandleRosterPresence=function(e,t,n,i){this.dispatchEvent({name:"RosterPresenceUpdate",id:e,resource:t,presence:n,message:i})}.bind(this),window.VIHandleMessage=function(e,t,n,i){if(this.imXSSprotection){var o=document.createElement("div");o.appendChild(document.createTextNode(n)),n=o.innerHTML}this.dispatchEvent({name:"MessageReceived",id:e,resource:t,content:n,message_id:i})}.bind(this),window.VIHandlePresence=function(e,t,n,i){this.dispatchEvent({name:"PresenceUpdate",id:e,resource:t,presence:n,message:i})}.bind(this),window.VIHandleChateState=function(e,t,n){this.dispatchEvent({name:"ChatStateUpdate",id:e,resource:t,state:n})}.bind(this),window.VIHandleMessageEvent=function(e,t,n,i){this.dispatchEvent({name:"MessageStatus",id:e,resource:t,type:n,message_id:i})}.bind(this),window.VIHandleRosterItem=function(e,t,n,i,o){this.dispatchEvent({name:"RosterItemChange",id:e,resource:t,type:n,displayName:o})}.bind(this),window.VIHandleSubscription=function(e,t,n,i){this.dispatchEvent({name:"SubscriptionRequest",id:e,resource:t,type:n,message:i})}.bind(this),window.VIHandleRemoteFunctionError=function(e,t,n,i){this.dispatchEvent({name:"IMError",errorType:"RemoteFunctionError",errorData:{method:e,params:JSON.parse(t),code:n,description:i}})}.bind(this),window.VIHandleIMError=function(e,t,n){this.dispatchEvent({name:"IMError",errorType:"Error",errorData:{type:e,code:t,description:n}})}.bind(this),window.VIHandleIMRosterError=function(e){this.dispatchEvent({name:"IMError",errorType:"RosterError",errorData:{code:e}})}.bind(this)},this.connectionState=function(e){return"undefined"==typeof e?i:void(i=e)},this.getCall=function(e){for(var t=0;t<this.calls.length;t++)if(this.calls[t].call()==e)return this.calls[t];return null},this.removeCall=function(e){for(var t=[],n=0;n<this.calls.length;n++)this.calls[n].call()!=e?t.push(this.calls[n]):delete this.calls[n];this.calls=t},this.playProgressTone=function(){null!==this.progressToneScript[this.progressToneCountry]&&(this.playingNow||this.playToneScript(this.progressToneScript[this.progressToneCountry]),this.playingNow=!0)},this.stopProgressTone=function(){this.playingNow&&(this.stopPlayback(),this.playingNow=!1)},this.__call=function(t,i,o,s){if("undefined"!=typeof o&&("undefined"==typeof s&&(s={}),s["VI-CallData"]=o),!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");var a,r;return this.RTCsupported&&!this.useFlashOnly?(a=this.zingayaAPI.callTo(t,i,s),r=new n(a,t,"",s,!0,this.zingayaAPI),this.calls.length>0&&this.zingayaAPI.setCallActive(a,!1)):this.useRTCOnly||(s=JSON.stringify(s),a=e.Utils.swfMovie("voximplantSWF").call(t,i,null,s),r=new n(a,t,"",s,!1),this.calls.length>0&&e.Utils.swfMovie("voximplantSWF").setCallActive(a,!1)),this.calls.push(r),r},this.__volume=function(e){return"undefined"==typeof e?o:void(o=e)},this.__cleanup=function(){if(this.calls.length>0){var e,t=[];for(e in this.calls)t.push(this.calls[e].id()),this.connectionState()&&this.calls[e].hangup();for(e in t)this.removeCall(t[e])}}},e.Client.prototype={call:function(e,t,n,i){return this.__call(e,t,n,i)},config:function(){return this.config},connect:function(){"undefined"!=typeof this.serverIp?(host=this.serverIp,this.connectTo(host)):(balancerResult=function(e){var t=String(e).indexOf(";");-1==t?host=e:(this.serversList=e.split(";"),host=this.serversList[0]),this.connectTo(host)},e.Utils.getServers(balancerResult.bind(this),!1,this))},connectTo:function(t,n){if(this.connectionState())throw new Error("ALREADY_CONNECTED_TO_VOXIMPLANT");this.host=t,this.RTCsupported&&!this.useFlashOnly?this.micRequired&&n!==!0?(this.videoSupport&&this.zingayaAPI.setConstraints(this.videoConstraints,null,null,!1),this.zingayaAPI.requestMedia(this.videoSupport,this.zingayaAPI.onMediaAccessGranted,this.zingayaAPI.onMediaAccessRejected)):this.zingayaAPI.connectTo(t,"platform"):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").connect(t,n===!0?!1:this.micRequired,this.micRequired&&this.showFlashSettings)},disconnect:function(){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.__cleanup(),this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.destroy():this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").disconnect();

},init:function(e){this.__init(e)},setOperatorACDStatus:function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.setOperatorACDStatus(t):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setOperatorACDStatus(t)},login:function(t,n,i){if(i="undefined"!=typeof i?i:{},i=e.Utils.extend({},i),!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.login(t,n,i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").login(t,n,JSON.stringify(i))},loginWithCode:function(t,n,i){if(i="undefined"!=typeof i?i:{},i=e.Utils.extend({serverPresenceControl:!1},i),!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.loginStage2(t,n,i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").loginStage2(t,n,JSON.stringify(i))},requestOneTimeLoginKey:function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.loginGenerateOneTimeKey(t):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").requestOneTimeLoginKey(t)},loginWithOneTimeKey:function(t,n,i){if(i="undefined"!=typeof i?i:{},i=e.Utils.extend({serverPresenceControl:!1},i),!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.loginUsingOneTimeKey(t,n,i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").loginUsingOneTimeKey(t,n,JSON.stringify(i))},connected:function(){return this.connectionState()},showLocalVideo:function(t){if("undefined"==typeof t&&(t=!0),this.RTCsupported&&!this.useFlashOnly)if(t)if(null===document.getElementById("voximplantlocalvideo")){var n=document.createElement("video");n.id="voximplantlocalvideo",n.autoplay="autoplay",n.muted="true",document.body.firstChild?document.body.insertBefore(n,document.body.firstChild):document.body.appendChild(n),this.zingayaAPI.setLocalVideoSink(n)}else document.getElementById("voximplantlocalvideo").style.display="block";else document.getElementById("voximplantlocalvideo").style.display="none";else this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").showLocalVideo(t)},setLocalVideoPosition:function(t,n){if(this.RTCsupported&&!this.useFlashOnly)throw new Error("Please use CSS to position '#voximplantlocalvideo' element");this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setSelfViewPosition(t,n)},setLocalVideoSize:function(t,n){if(this.RTCsupported&&!this.useFlashOnly)throw new Error("Please use CSS to set size of '#voximplantlocalvideo' element");this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setSelfViewSize(t,n)},setVideoSettings:function(t,n,i,o){if(this.RTCsupported&&!this.useFlashOnly)this.zingayaAPI.setConstraints(t,function(){null!==document.getElementById("voximplantlocalvideo")&&this.zingayaAPI.setLocalVideoSink(document.getElementById("voximplantlocalvideo")),this.videoConstraints=t,"function"==typeof n&&n()}.bind(this),i,!0);else if(!this.useRTCOnly){"[object Object]"==Object.prototype.toString.call(t)&&(t=JSON.stringify(t));try{e.Utils.swfMovie("voximplantSWF").setVideoSettings(t)}catch(s){"function"==typeof i&&i()}"function"==typeof n&&n()}},playToneScript:function(t,n){this.RTCsupported&&!this.useFlashOnly?e.Utils.playToneScript(t,n):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").playToneScript(t,n)},stopPlayback:function(){this.RTCsupported&&!this.useFlashOnly?e.Utils.stopPlayback()&&this.dispatchEvent({name:"PlaybackFinished"}):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").stopPlayback()},volume:function(t){return"undefined"==typeof t?this.__volume():(t>100&&(t=100),0>t&&(t=0),this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.setPlaybackVolume(t/100):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").changeIncomingAudioVolume(t),this.__volume(t),void 0)},audioSources:function(){if(this.RTCsupported&&!this.useFlashOnly&&!this.deviceEnumAPI)throw new Error("NOT_SUPPORTED [MediaStreamTrack.getSources]");return this.audioSourcesList},videoSources:function(){if(this.RTCsupported&&!this.useFlashOnly&&!this.deviceEnumAPI)throw new Error("NOT_SUPPORTED [MediaStreamTrack.getSources]");return this.videoSourcesList},useAudioSource:function(t,n,i){this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.useAudioSource(t,n,i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setAudioSource(t)},useVideoSource:function(t,n,i){this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.useVideoSource(t,function(){null!==document.getElementById("voximplantlocalvideo")&&this.zingayaAPI.attachLocalVideoToSink(document.getElementById("voximplantlocalvideo")),"function"==typeof n&&n()}.bind(this),i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setVideoSource(t)},attachRecordingDevice:function(e,t){!this.RTCsupported||this.useFlashOnly||this.micRequired||this.zingayaAPI.requestMedia(this.videoSupport,e,t)},detachRecordingDevice:function(){!this.RTCsupported||this.useFlashOnly||this.micRequired||this.zingayaAPI.stopLocalStream()},showFlashSettingsPanel:function(t){"undefined"==typeof t&&(t="default"),this.RTCsupported&&!this.useFlashOnly||this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").showFlashSettings(t)},setCallActive:function(t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.setCallActive(t.call(),n):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setCallActive(t.call(),n)},sendVideo:function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");"undefined"==typeof t&&(t=!0),this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.sendVideo(t):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").sendVideo(t)},isRTCsupported:function(){return this.RTCsupported},transferCall:function(t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.transferCall(t.call(),n.call()):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").transferCall(t.call(),n.call())},setSwfColor:function(t){this.RTCsupported&&!this.useFlashOnly||this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setStageColor(t)},setCodecPayload:function(t){this.RTCsupported&&!this.useFlashOnly||this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").setCodecPayload(t)},startScreenSharing:function(){this.RTCsupported&&!this.useFlashOnly&&this.zingayaAPI.shareScreen()}},e.Client.prototype.addEventListener=function(e,t){"undefined"==typeof this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.Client.prototype.removeEventListener=function(e,t){if("undefined"!=typeof this.eventListeners[e])for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}},e.Client.prototype.dispatchEvent=e.Call.prototype.dispatchEvent=function(e){var t=e.name;if("undefined"!=typeof this.eventListeners[t])for(var n=0;n<this.eventListeners[t].length;n++)"function"==typeof this.eventListeners[t][n]&&this.eventListeners[t][n](e)}}(n),function(e,t){e.Client.prototype.addRosterItem=function(t,n,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");"undefined"==typeof i&&(i=""),this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.addRoster(t,n,i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").addRosterItem(t,n,i)},e.Client.prototype.removeRosterItem=function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.removeRoster(t):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").removeRosterItem(t)},e.Client.prototype.renameRosterItem=function(t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.renameRosterItem(t,n):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").renameRosterItem(t,n)},e.Client.prototype.addRosterItemGroup=function(t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.addRosterItemGroup(t,n):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").addRosterItemGroup(t,n)},e.Client.prototype.removeRosterItemGroup=function(t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.delRosterItemGroup(t,n):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").delRosterItemGroup(t,n)},e.Client.prototype.moveRosterItemGroup=function(t,n,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.moveRosterItemGroup(t,n,i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").moveRosterItemGroup(t,n,i)},e.Client.prototype.sendInstantMessage=function(t,n){var i=e.Utils.generateUUID();if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");return this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.sendTextMessage(t,n,i):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").sendInstantMessage(t,n,i),i},e.Client.prototype.setChatState=function(t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.sendChatState(t,n):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").sendChatState(t,n)},e.Client.prototype.setMessageStatus=function(t,n,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if("string"==typeof i)i=[i];else if(!Array.isArray(i))throw new Error("message_id should be string or array");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.raiseMessageEvent(t,n,JSON.stringify(i)):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").raiseMessageEvent(t,n,JSON.stringify(i))},e.Client.prototype.setPresenceStatus=function(t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.sendStatus(t,n):this.useRTCOnly||e.Utils.swfMovie("voximplantSWF").sendStatus(t,n)},e.Client.prototype.createChatRoom=function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");var n=e.Utils.generateUUID();return this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.joinMUC(n,t):!this.useRTCOnly,n},e.Client.prototype.joinChatRoom=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.joinMUC(e,t):!this.useRTCOnly},e.Client.prototype.acceptChatRoomInvite=e.Client.prototype.joinChatRoom,e.Client.prototype.leaveChatRoom=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.leaveMUC(e,t):!this.useRTCOnly},e.Client.prototype.sendChatRoomMessage=function(t,n){var i=e.Utils.generateUUID();if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");return this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.sendMUCMessage(t,n,i):!this.useRTCOnly,i},e.Client.prototype.inviteToChatRoom=function(e,t,n,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.inviteMUC(e,t,n,i):!this.useRTCOnly},e.Client.prototype.declineChatRoomInvite=function(e,t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.declineMUCinvitation(e,t,n):!this.useRTCOnly},e.Client.prototype.setChatRoomSubject=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.setSubject(e,t):!this.useRTCOnly},e.Client.prototype.removeChatRoomUser=function(e,t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.kickMUCUser(e,t,n):!this.useRTCOnly},e.Client.prototype.banChatRoomUser=function(e,t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.banMUCUser(e,t,n):!this.useRTCOnly},e.Client.prototype.unbanChatRoomUser=function(e,t,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.unbanMUCUser(e,t,n):!this.useRTCOnly},e.Client.prototype.getInstantMessagingHistory=function(e,t,n,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.requestHistory(e,t,n,i):!this.useRTCOnly},e.Client.prototype.getChatRoomHistory=function(e,t,n,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.RTCsupported&&!this.useFlashOnly?this.zingayaAPI.requestMUCHistory(e,t,n,i):!this.useRTCOnly}}(n),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),!window.JSON)throw new Error("Unsupported browser");!function(e,n){e.Utils={source:null,extend:function(e){var t={},n=function(e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])};n(arguments[0]);for(var i=1;i<arguments.length;i++){var o=arguments[i];n(o)}return t},swfMovie:function(e){return-1!=navigator.appName.indexOf("Microsoft")?window[e]:document[e]},stringifyExtraHeaders:function(e){return e="[object Object]"==Object.prototype.toString.call(e)?JSON.stringify(e):null},cadScript:function(e){var t=e.split(";");return t.map(function(e){if(0!==e.length){var t=e.match(/\([0-9\/\.,\*\+]*\)$/),n=e.substring(0,t.index),i=t.pop();if(t.length)throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`");if(n="*"===n?1/0:parseFloat(n),isNaN(n))throw new Error("cadence length should be of the form `%f`");return i=i.slice(1,i.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3)throw new Error;return t=t.map(function(e,t){if(2===t){var n=e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error;return t-1});return n}var i;if("*"==e&&(i=1/0),i=i?i:parseFloat(e,10),isNaN(i))throw new Error;return i}),{on:t[0],off:t[1],frequencies:t[2]}}catch(n){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}}),{duration:n,sections:i}}})},freqScript:function(e){var t=e.split(",");return t.map(function(e){try{var t=e.split("@"),n=parseInt(t.shift()),i=parseFloat(t.shift());if(t.length)throw Error();return{frequency:n,decibels:i}}catch(o){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})},toneScript:function(t){var n=t.split(";"),i=e.Utils.freqScript(n.shift()),o=e.Utils.cadScript(n.join(";"));return{frequencies:i,cadences:o}},playToneScript:function(n,i){if("undefined"!=typeof window.AudioContext||"undefined"!=typeof window.webkitAudioContext){window.AudioContext=window.AudioContext||window.webkitAudioContext;var o=new AudioContext,s=e.Utils.toneScript(n),a=[],r=0;processCadence=function(e){r+=e.duration!=1/0?e.duration:20;for(var t=0;t<e.sections.length;t++)processSection(e.sections[t],e.duration)},processSection=function(e,n){if(t=n!=1/0?n:n=20,0!==e.off&&e.off!=1/0)for(;t>0;)addSound(e.frequencies,e.on),t-=e.on,addSilence(e.off),t-=e.off,t=parseInt(10*t)/10;else addSound(e.frequencies,n)},addSilence=function(e){for(var t=0;t<o.sampleRate*e;t++)a.push(0)},addSound=function(e,t){for(var n=0;n<o.sampleRate*t;n++){for(var i=0,r=0;r<e.length;r++)i+=Math.pow(10,s.frequencies[e[r]].decibels/20)*Math.sin((a.length+n)*(3.14159265359/o.sampleRate)*s.frequencies[e[r]].frequency),10>n&&(i*=n/10),n>o.sampleRate*t-10&&(i*=(o.sampleRate*t-n)/10);a.push(i)}},this.source=o.createBufferSource();for(var l=0;l<s.cadences.length;l++)s.cadences[l].duration==1/0&&(this.source.loop=!0),processCadence(s.cadences[l]);this.source.connect(o.destination),sndBuffer=o.createBuffer(1,r*o.sampleRate,o.sampleRate),bufferData=sndBuffer.getChannelData(0);for(var c=0;c<r*o.sampleRate;c++)bufferData[c]=a[c];a=null,this.source.buffer=sndBuffer,i===!0&&(this.source.loop=!0),this.source.start(0)}},stopPlayback:function(){return null!==this.source?(this.source.stop(0),this.source=null,!0):!1},sendRequest:function(e,t,n,i){var o=!1,s=function(){for(var e=[function(){return new XDomainRequest},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=!1,n=0;n<e.length;n++){try{t=e[n](),0===n&&(o=!0)}catch(i){continue}break}return t},a=s();if(a){var r=i?"POST":"GET";if(o)a.onerror=function(){n(a)},a.ontimeout=function(){n(a)},a.onload=function(){t(a)},a.open(r,e),a.timeout=5e3,a.send();else{if(a.open(r,e,!0),i&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){return 4==a.readyState?200!=a.status&&304!=a.status?void n(a):void t(a):void 0},4==a.readyState)return;a.send(i)}}},getServers:function(t,n,i){function o(o){null!==o?t(o):n!==!0?e.Utils.getServers(t,!0,i):i.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})}var s="https:"==document.location.protocol?"https://":"http://";balancer_url=n===!0?s+"balancer2.voximplant.com/getNearestHost":s+"balancer.voximplant.com/getNearestHost",e.Utils.sendRequest(balancer_url,function(e){o(e.responseText)},function(e){o(null)})},generateUUID:function(){var t=e.Utils._gri,n=e.Utils._ha;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)},_gri:function(e){return 0>e?0/0:30>=e?0|Math.random()*(1<<e):53>=e?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):0/0},_ha:function(e,t){for(var n=e.toString(16),i=t-n.length,o="0";i>0;i>>>=1,o+=o)1&i&&(n=o+n);return n}},e.getInstance=function(){return e._clientInstance},e.version=e.Client.prototype.version="3.0.15856",e._clientInstance||(e._clientInstance=new e.Client,delete e.Client)}(n),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.VoxImplant=n):e.VoxImplant=n}).call(this);